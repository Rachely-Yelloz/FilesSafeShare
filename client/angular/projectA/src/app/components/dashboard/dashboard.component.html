<button mat-raised-button color="warn" class="logout-btn" (click)="logOut()">
    <mat-icon>logout</mat-icon> התנתק</button>
<div class="dashboard-container" *ngIf="!loading(); else spinner">

  <!-- סטטיסטיקות עליונות -->
  <div class="stats-cards">
    <mat-card *ngFor="let card of stats" class="stat-card" [style.border-left-color]="card.color">
      <mat-card-content>
        <div class="card-header">
          <mat-icon>{{ card.icon }}</mat-icon>
          <span class="card-title">{{ card.title }}</span>
        </div>
        <div class="card-value">{{ card.value }}</div>
        <div class="card-trend" *ngIf="card.trend !== undefined">
          <mat-icon>{{ card.trend >= 0 ? 'trending_up' : 'trending_down' }}</mat-icon>
          {{ card.trend }}%
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- סיכום פעילות -->
  <div class="activity-summary">
    <mat-card>
      <mat-card-title>סיכום פעילות</mat-card-title>
      <mat-card-content>
        <p>פעולות היום: {{ activitySummary.todayActions }}</p>
        <p>משתמש פעיל ביותר: {{ activitySummary.mostActiveUser }}</p>
        <p>שעה שיא: {{ activitySummary.peakHour }}</p>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- פילטרים וחיפוש -->
  <div class="filters">
    <mat-form-field appearance="fill">
      <mat-label>חיפוש</mat-label>
      <input matInput [(ngModel)]="searchText" placeholder="חפש משתמש או פעולה">
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>סטטוס</mat-label>
      <mat-select [(ngModel)]="statusFilter">
        <mat-option value="all">הכל</mat-option>
        <mat-option value="success">מוצלח</mat-option>
        <mat-option value="error">כושל</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>תקופת זמן</mat-label>
      <mat-select [(ngModel)]="timeFilter">
        <mat-option value="all">הכל</mat-option>
        <mat-option value="day">יום</mat-option>
        <mat-option value="week">שבוע</mat-option>
        <mat-option value="month">חודש</mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-raised-button color="primary" (click)="refreshData()">
      <mat-icon>refresh</mat-icon> רענן
    </button>

    <button mat-raised-button color="accent" (click)="exportToCSV()">
      <mat-icon>download</mat-icon> ייצוא CSV
    </button>
  </div>

  <!-- טבלת לוגים -->
  <div class="logs-table">
    <table mat-table [dataSource]="filteredLogs()" class="mat-elevation-z8">

      <!-- משתמש -->
      <ng-container matColumnDef="user">
        <th mat-header-cell *matHeaderCellDef> משתמש </th>
        <td mat-cell *matCellDef="let log"> {{ log.userName }} </td>
      </ng-container>

      <!-- פעולה -->
      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef> פעולה </th>
        <td mat-cell *matCellDef="let log">
          <mat-icon>{{ getActionIcon(log.action) }}</mat-icon>
          {{ log.action }}
        </td>
      </ng-container>

      <!-- זמן -->
      <ng-container matColumnDef="time">
        <th mat-header-cell *matHeaderCellDef> זמן </th>
        <td mat-cell *matCellDef="let log"> {{ log.createdAt | date:'short' }} </td>
      </ng-container>

      <!-- סטטוס -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef> סטטוס </th>
        <td mat-cell *matCellDef="let log">
          <span [ngClass]="getStatusColor(log.isSuccess)">
            {{ log.isSuccess ? 'מוצלח' : 'כושל' }}
          </span>
        </td>
      </ng-container>

      <!-- פעולות -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> פעולות </th>
        <td mat-cell *matCellDef="let log">
          <button mat-icon-button matTooltip="פרטים נוספים">
            <mat-icon>info</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

</div>

<ng-template #spinner>
  <div class="spinner-container">
    <mat-spinner></mat-spinner>
  </div>
</ng-template>
